(()=>{"use strict";var e,t,i,s={default:{base:"#6c6685",background:"#423e54",black:"#3c4368"},orange:{base:"#a66202",background:"#442801",black:"#3c4368"},lightblue:{base:"#0278a6",background:"#01364b",black:"#3c4368"},blue:{base:"#625df5",background:"#232155",black:"#3c4368"},lightyellow:{base:"#ffc65c",background:"#644e26",black:"#3c4368"},green:{base:"#30874b",background:"#153b21",black:"#3c4368"},red:{base:"#b53434",background:"#581a1a",black:"#3c4368"}},a=function(){return a=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},a.apply(this,arguments)};!function(e){e.Spades="Spades",e.Clubs="Clubs",e.Diamonds="Diamonds",e.Hearts="Hearts"}(e||(e={})),function(e){e.Spades="♠",e.Clubs="♣",e.Diamonds="♦",e.Hearts="♥"}(t||(t={})),function(e){e.Two="2",e.Three="3",e.Four="4",e.Five="5",e.Six="6",e.Seven="7",e.Eight="8",e.Nine="9",e.Ten="10",e.Jack="J",e.Queen="Q",e.King="K",e.Ace="A"}(i||(i={})),e.Spades,e.Clubs,e.Diamonds,e.Hearts;var o=function(){function t(){var e=this;this.gameAspectRatio=1.6,this.theme=s.default,this.clickCoordinates={x:0,y:0},this.scaledClickCoordinates={x:0,y:0},this.mouseCoordinates={x:0,y:0},this.scaledMouseCoordinates={x:0,y:0},this.isMouseClicked=!1,this.gameRunning=!0,this.deckIndex=0,this.timerInMs=0,this.lastTimestamp=0,this.buttons=[],this.themeButtons=[],this.isDealNewRound=!0,this.pile1=[],this.pile2=[],this.pile3=[],this.pile4=[],this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.cardFaceSpriteSheet=new Image,this.cardFaceSpriteSheet.src="img/deck-sprite-sheet.png",this.cardBackSpriteSheet=new Image,this.cardBackSpriteSheet.src="img/card-backs-seals.png",this.iconSpriteSheet=new Image,this.iconSpriteSheet.src="img/icons.png",Promise.all([this.loadImage(this.cardFaceSpriteSheet),this.loadImage(this.cardBackSpriteSheet),this.loadImage(this.iconSpriteSheet)]).then((function(){e.startGame()}))}return t.prototype.loadImage=function(e){return new Promise((function(t){e.onload=function(){return t()}}))},t.prototype.startGame=function(){var e=this;console.log("Game started",this),this.canvas.addEventListener("click",(function(t){var i=e.canvas.getBoundingClientRect(),s=t.clientX-i.left,a=t.clientY-i.top;e.clickCoordinates={x:s,y:a},e.scaledClickCoordinates={x:s/e.scaleFactor,y:a/e.scaleFactor},e.isMouseClicked=!0})),document.addEventListener("mousemove",(function(t){var i=e.canvas.getBoundingClientRect();e.mouseCoordinates={x:t.clientX-i.left,y:t.clientY-i.top},e.scaledMouseCoordinates={x:e.mouseCoordinates.x/e.scaleFactor,y:e.mouseCoordinates.y/e.scaleFactor}})),this.gameRunning=!0,this.lastTimestamp=performance.now(),this.deck=this.buildAndShuffleDeck(!0),this.initializePiles(),this.isDealNewRound=!1,this.initializeGameObjects(),this.gameLoop()},t.prototype.initializeGameObjects=function(){this.createReloadButton(),this.createDealButton(),this.createHitButton(),this.createThemeButtons(),this.createPlayerCard()},t.prototype.gameLoop=function(e){var t=this;if(void 0===e&&(e=0),this.gameRunning){var i=e-this.lastTimestamp;this.lastTimestamp=e,this.timerInMs+=i,this.updateGameState(),this.render(),this.resetGameState(),requestAnimationFrame((function(e){return t.gameLoop(e)}))}},t.prototype.updateGameState=function(){var e,t,i,s,o,n=this;if(this.buttons.forEach((function(t){var i,s,a,o;(null===(i=n.scaledMouseCoordinates)||void 0===i?void 0:i.x)>=t.x&&(null===(s=n.scaledMouseCoordinates)||void 0===s?void 0:s.x)<=t.x+t.width&&(null===(a=n.scaledMouseCoordinates)||void 0===a?void 0:a.y)>=t.y&&(null===(o=n.scaledMouseCoordinates)||void 0===o?void 0:o.y)<=t.y+t.height&&((e=t).isHovered=!0)})),e&&this.isMouseClicked)switch(e.id){case"reload":window.location.reload();break;case"deal":this.isDealNewRound=!0;break;case"hit":this.hitCard()}this.themeButtons.forEach((function(e){var i,s,a,o;(null===(i=n.scaledMouseCoordinates)||void 0===i?void 0:i.x)>=e.x&&(null===(s=n.scaledMouseCoordinates)||void 0===s?void 0:s.x)<=e.x+e.width&&(null===(a=n.scaledMouseCoordinates)||void 0===a?void 0:a.y)>=e.y&&(null===(o=n.scaledMouseCoordinates)||void 0===o?void 0:o.y)<=e.y+e.height&&((t=e).isHovered=!0)})),t&&this.isMouseClicked&&(this.theme=t.theme),[this.playerCard].forEach((function(e){var t,s,a,o;(null===(t=n.scaledMouseCoordinates)||void 0===t?void 0:t.x)>=e.x&&(null===(s=n.scaledMouseCoordinates)||void 0===s?void 0:s.x)<=e.x+e.width*e.scale&&(null===(a=n.scaledMouseCoordinates)||void 0===a?void 0:a.y)>=e.y&&(null===(o=n.scaledMouseCoordinates)||void 0===o?void 0:o.y)<=e.y+e.height*e.scale&&(i=e)})),i&&this.isMouseClicked&&(this.lastCardClicked=i,"player"===i.id)&&console.log("Player card clicked",i),[this.pile1,this.pile2,this.pile3,this.pile4].forEach((function(e){var t,i,a,r,c=e[e.length-1];(null===(t=n.scaledMouseCoordinates)||void 0===t?void 0:t.x)>=c.x&&(null===(i=n.scaledMouseCoordinates)||void 0===i?void 0:i.x)<=c.x+c.width*c.scale&&(null===(a=n.scaledMouseCoordinates)||void 0===a?void 0:a.y)>=c.y&&(null===(r=n.scaledMouseCoordinates)||void 0===r?void 0:r.y)<=c.y+c.height*c.scale&&(s=e,o=c)})),o&&this.isMouseClicked&&(console.log("Pile click pile",s),console.log("Pile click card",o),s.push(a(a({},o),{suit:this.playerCard.suit,value:this.playerCard.value})),this.deck.splice(this.deckIndex,1),0===this.deckIndex?this.deckIndex=2:this.deckIndex--,this.playerCard.suit=this.deck[this.deckIndex].suit,this.playerCard.value=this.deck[this.deckIndex].value),this.isDealNewRound&&(this.deck=this.buildAndShuffleDeck(!0),this.initializePiles(),this.isDealNewRound=!1)},t.prototype.resetGameState=function(){this.clickCoordinates=null,this.scaledClickCoordinates=null,this.isMouseClicked=!1,this.buttons.forEach((function(e){e.isHovered=!1})),this.themeButtons.forEach((function(e){e.isHovered=!1}))},t.prototype.createPlayerCard=function(){var e;if(null===(e=this.deck)||void 0===e?void 0:e.length){var t=this.deck[this.deckIndex];this.playerCard=a(a({},t),{id:"player",x:585,y:460,width:71,height:95,scale:1.5})}},t.prototype.createReloadButton=function(){var e="RELOAD",t=this.ctx.measureText(e).width+40+5;this.buttons.push({id:"reload",text:e,padding:20,fillColor:this.theme.base,x:10,y:730,width:t,height:50})},t.prototype.createDealButton=function(){var e="DEAL",t=this.ctx.measureText(e).width+40;this.buttons.push({id:"deal",text:e,padding:20,fillColor:this.theme.base,x:10,y:670,width:t,height:50})},t.prototype.createHitButton=function(){var e=this.ctx.measureText("HIT").width+40;this.buttons.push({id:"hit",text:"HIT",padding:20,fillColor:this.theme.base,x:610,y:390,width:e,height:50})},t.prototype.createThemeButtons=function(){for(var e=0,t=0,i=Object.keys(s);t<i.length;t++){var a=i[t],o=400+70*e;this.themeButtons.push({id:"theme",text:"",theme:s[a],padding:20,fillColor:s[a].base,x:o,y:700,width:50,height:50}),e++}},t.prototype.render=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.renderTheme(),this.renderPlayerCard(),this.renderPiles(),this.renderDeckIndex(),this.renderTimer(),this.renderMousePosition(),this.renderLastCardClicked(),this.renderButtons(),this.renderThemeButtons()},t.prototype.renderTheme=function(){this.canvas.style.backgroundColor=this.theme.background},t.prototype.renderButtons=function(){var e=this;this.buttons.forEach((function(t){e.ctx.fillStyle=e.theme.base,e.ctx.fillRect(t.x,t.y,t.width,t.height),e.printText(t.text,t.x+t.padding/2,t.y+1.75*t.padding),t.isHovered&&(e.ctx.strokeStyle="white",e.ctx.lineWidth=2,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}))},t.prototype.renderThemeButtons=function(){var e=this;this.themeButtons.forEach((function(t){e.ctx.fillStyle=t.fillColor,e.ctx.fillRect(t.x,t.y,t.width,t.height),t.isHovered&&(e.ctx.strokeStyle="white",e.ctx.lineWidth=2,e.ctx.strokeRect(t.x,t.y,t.width,t.height))}))},t.prototype.renderDeckIndex=function(){var e,t,i="".concat(this.deckIndex," / ").concat(null===(e=this.deck)||void 0===e?void 0:e.length),s=585+(106.5-this.ctx.measureText(i).width)/2;this.printText("".concat(this.deckIndex+1,"  / ").concat(null===(t=this.deck)||void 0===t?void 0:t.length),s,630)},t.prototype.renderPlayerCard=function(){this.drawCard(this.playerCard,this.playerCard.x,this.playerCard.y,this.playerCard.scale)},t.prototype.renderPiles=function(){var e=200,t=this.pile1,i=this.pile2,s=this.pile3,a=this.pile4,o=t[t.length-1];o.width=71,o.height=95,o.x=366.5,o.y=e,o.scale=1.5;var n=i[i.length-1];n.width=71,n.height=95,n.x=513,n.y=e,n.scale=1.5;var r=s[s.length-1];r.width=71,r.height=95,r.x=659.5,r.y=e,r.scale=1.5;var c=a[a.length-1];c.width=71,c.height=95,c.x=806,c.y=e,c.scale=1.5,this.drawCard(o,o.x,o.y,o.scale),this.drawCard(n,n.x,n.y,n.scale),this.drawCard(r,r.x,r.y,r.scale),this.drawCard(c,c.x,c.y,c.scale)},t.prototype.renderTimer=function(){var e=Math.floor(this.timerInMs/6e4).toString().padStart(2,"0"),t=Math.floor(this.timerInMs%6e4/1e3).toString().padStart(2,"0"),i=Math.floor(this.timerInMs%1e3/100).toString().padStart(1,"0");this.printText("Time: ".concat(e,":").concat(t,".").concat(i),20,60)},t.prototype.renderMousePosition=function(){var e=parseFloat(this.scaledMouseCoordinates.x.toFixed(0)),t=parseFloat(this.scaledMouseCoordinates.y.toFixed(0));this.printText("Cursor: X ".concat(e," | Y ").concat(t),170,60)},t.prototype.renderLastCardClicked=function(){var e=this.lastCardClicked;e&&(this.printText("Card: ".concat(e.value),20,100),this.drawIcon(e.suit,110,83))},t.prototype.printText=function(e,t,i){this.ctx.font="20px Balatro",this.ctx.fillStyle="white",this.ctx.shadowColor="rgba(0, 0, 0, 0.5)",this.ctx.shadowBlur=4,this.ctx.shadowOffsetX=2,this.ctx.shadowOffsetY=2,this.ctx.fillText(e,t,i),this.ctx.shadowColor="transparent",this.ctx.shadowBlur=0,this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0},t.prototype.pauseGame=function(){this.gameRunning=!1},t.prototype.buildAndShuffleDeck=function(t){void 0===t&&(t=!1);for(var s=[],a=0,o=Object.values(e);a<o.length;a++)for(var n=o[a],r=0,c=Object.values(i);r<c.length;r++){var h=c[r];s.push({suit:n,value:h})}if(t)for(var d=0;d<s.length;d++){var l=Math.floor(Math.random()*s.length),u=s[d];s[d]=s[l],s[l]=u}return s},t.prototype.initializePiles=function(){this.pile1=[],this.pile2=[],this.pile3=[],this.pile4=[],this.pile1.push(this.deck.pop()),this.pile2.push(this.deck.pop()),this.pile3.push(this.deck.pop()),this.pile4.push(this.deck.pop())},t.prototype.hitCard=function(){this.deckIndex+=3,this.deckIndex>=this.deck.length&&(this.deckIndex=this.deckIndex-this.deck.length),this.playerCard.suit=this.deck[this.deckIndex].suit,this.playerCard.value=this.deck[this.deckIndex].value},t.prototype.drawCard=function(t,s,a,o){void 0===o&&(o=1);var n=0,r=0;switch(t.suit){case e.Hearts:n=0;break;case e.Clubs:n=95;break;case e.Diamonds:n=190;break;case e.Spades:n=285}switch(t.value){case i.Two:r=0;break;case i.Three:r=71;break;case i.Four:r=142;break;case i.Five:r=213;break;case i.Six:r=284;break;case i.Seven:r=355;break;case i.Eight:r=426;break;case i.Nine:r=497;break;case i.Ten:r=568;break;case i.Jack:r=639;break;case i.Queen:r=710;break;case i.King:r=781;break;case i.Ace:r=852}this.ctx.drawImage(this.cardBackSpriteSheet,71,0,71,95,s,a,71*o,95*o),this.ctx.drawImage(this.cardFaceSpriteSheet,r,n,71,95,s,a,71*o,95*o)},t.prototype.drawIcon=function(t,i,s){var a=0;switch(t){case e.Hearts:a=0;break;case e.Diamonds:a=18;break;case e.Clubs:a=36;break;case e.Spades:a=54}this.drawRoundedRect(this.ctx,i-2.5,s-2.5,23,23.5,5),this.ctx.drawImage(this.iconSpriteSheet,a,18.5,18,18.5,i,s,18,18.5)},t.prototype.drawRoundedRect=function(e,t,i,s,a,o){e.beginPath(),e.moveTo(t+o,i),e.lineTo(t+s-o,i),e.arcTo(t+s,i,t+s,i+o,o),e.lineTo(t+s,i+a-o),e.arcTo(t+s,i+a,t+s-o,i+a,o),e.lineTo(t+o,i+a),e.arcTo(t,i+a,t,i+a-o,o),e.lineTo(t,i+o),e.arcTo(t,i,t+o,i,o),e.closePath(),e.fill()},t.prototype.sleep=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.prototype.scaleGame=function(){console.log("Scaling game");var e=window.innerWidth,t=window.innerHeight;this.windowAspectRatio=e/t,this.windowAspectRatio>this.gameAspectRatio?this.scaleFactor=t/800:this.scaleFactor=e/1280;var i=document.getElementById("game-canvas");i.style.transform="scale(".concat(this.scaleFactor,")"),i.style.transformOrigin="top left",i.style.width="".concat(1280,"px"),i.style.height="".concat(800,"px")},t}();document.addEventListener("DOMContentLoaded",(function(){var e=new o;window.game=e,e.scaleGame(),window.addEventListener("resize",(function(){return e.scaleGame()}))}))})();